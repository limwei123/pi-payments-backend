<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pi SDK Minimal Test (v4)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0b0b0f;color:#fff;margin:0;padding:16px}
    h1{margin:10px 0 14px;font-size:34px}
    .card{background:#141421;border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:14px;margin:12px 0}
    button{width:100%;padding:12px 14px;border-radius:14px;border:0;font-weight:800}
    button:disabled{opacity:.45}
    .primary{background:#fff;color:#000}
    .indigo{background:#b7b9ff;color:#000}
    .emerald{background:#8ff0c6;color:#000}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;white-space:pre-wrap;word-break:break-word}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > button{flex:1;min-width:180px}
    a{color:#9ad}
    .badge{display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;background:rgba(255,255,255,.12);margin-left:8px;vertical-align:middle}
  </style>

  <!-- Load Pi SDK ONCE -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>

  <!-- IMPORTANT: define direct click functions in global scope BEFORE body buttons are clicked -->
  <script>
    // pi-auth.js will assign these. We keep stubs so button click never errors.
    window.__piReloadClick = window.__piReloadClick || function(){ console.log("Reload handler not ready yet"); };
    window.__piSignInClick = window.__piSignInClick || function(){ console.log("Sign-in handler not ready yet"); };
    window.__piPayClick = window.__piPayClick || function(){ console.log("Pay handler not ready yet"); };
  </script>
</head>
<body>
  <h1>Pi SDK Minimal Test <span class="badge">v4</span></h1>

  <div class="card">
    <div><b>Open inside:</b> Pi Browser Sandbox</div>
    <div style="opacity:.85;margin-top:6px">
      If sign-in fails, ensure you opened
      <span class="mono">sandbox.minepi.com/app/ultra-video-maker</span>
      and the loaded hostname matches your portal Development URL.
    </div>
  </div>

  <div class="card">
    <div><b>Environment</b></div>
    <div class="mono" id="env"></div>
  </div>

  <div class="card">
    <div><b>Status</b></div>
    <div class="mono" id="status">Loadingâ€¦</div>

    <div class="row" style="margin-top:12px">
      <!-- Inline onclick ensures Pi.authenticate is triggered from a true user gesture -->
      <button id="reloadBtn" class="primary" type="button" onclick="window.__piReloadClick()">Reload Pi SDK</button>
      <button id="signinBtn" class="indigo" type="button" onclick="window.__piSignInClick()" disabled>Sign in with Pi</button>
    </div>

    <div class="row" style="margin-top:10px">
      <button id="payBtn" class="emerald" type="button" onclick="window.__piPayClick()" disabled>Pay with Pi (1 Pi)</button>
    </div>

    <div style="opacity:.8;margin-top:8px" id="userLine">Not signed in</div>
  </div>

  <div class="card">
    <div><b>Log</b></div>
    <div class="mono" id="log"></div>
  </div>

  <!-- Cache-buster forces Pi Browser to fetch latest JS -->
  <script src="./pi-auth.js?v=4"></script>
</body>
</html>
